#  Makefile for storage modules in the Squid Object Cache server
#
#  $Id: Makefile.in,v 1.2 2000/08/19 14:23:19 hno Exp $
#

SUBDIRS		= @REPL_POLICIES@
OUTLIBS		= @REPL_LIBS@

all:
	@test -z "$(SUBDIRS)" || for dir in $(SUBDIRS); do \
	   sh -c "cd $$dir && $(MAKE) $(MFLAGS) all" || exit 1; \
	done; \
	if [ ! -f stamp ]; then \
	   touch stamp; \
	fi

$(OUTLIBS):
	@sh -c "cd `basename $@ .a` && $(MAKE) $(MFLAGS) ../$@"

clean:
	-rm -f *.a stamp
	-for dir in *; do \
	    if [ -f $$dir/Makefile ]; then \
	       sh -c "cd $$dir && $(MAKE) $(MFLAGS) $@" || exit 1;\
	    fi; \
	done

distclean:
	-rm -f *.a Makefile
	-for dir in *; do \
	    if [ -f $$dir/Makefile ]; then \
		sh -c "cd $$dir && $(MAKE) $(MFLAGS) distclean"; \
	    fi; \
	done

.DEFAULT:
	@test -z "$(SUBDIRS)" || for dir in $(SUBDIRS); do \
	   sh -c "cd $$dir && $(MAKE) $(MFLAGS) $@" || exit 1; \
	done
